<!DOCTYPE html>
<html lang="zh">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.0 -->

    <!-- Title -->
    
    <title>
        
            Android 条码扫描 | 
        
        BearZPY Blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#FF4081">
    <meta name="author" content="BearZPY">
    <meta name="description" content="null">
    <meta name="keywords" content="null,Android,ZXing">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="BearZPY Blog">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://pengyuzhang.coding.me/PengyuZhang.coding.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Android 条码扫描 | BearZPY Blog">
    <meta property="og:description" content="null">
    <meta property="og:article:tag" content="Android"> <meta property="og:article:tag" content="ZXing"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #FF4081;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #3F51B5 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #3F51B5 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #3F51B5 !important;
  }

  .toTop {
    background: #FF4081 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #FF4081;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #FF4081;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #FF4081;
  }

  .post-toc a:hover {
    color: #FF4081;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #C5CAE9;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>



    <script src="/js/jquery.min.js"></script>
    <script src="/js/queue.js"></script>

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    

    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Android-条码扫描"><span class="post-toc-number">1.</span> <span class="post-toc-text">Android 条码扫描</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#确定扫码功能的核心"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">确定扫码功能的核心</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#拍摄功能"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">拍摄功能</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Camera-的基本参数配置"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">Camera 的基本参数配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#View-的参数配置"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">View 的参数配置</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#解码功能"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">解码功能</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ZXing-解码器配置"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">ZXing 解码器配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#拍摄图像处理"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">拍摄图像处理</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ZXing-官方例子补充"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">ZXing 官方例子补充</span></a></li></ol></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').css('background-image', 'url(' + '/img/random/material-' + randomNum + '.png' + ')');
</script>

        
    
            <p class="article-headline-p">
                Android 条码扫描
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/user.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>BearZPY</strong>
        <span>3月 14, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
            <i class="material-icons" role="presentation">devices other</i>
            <span class="visuallyhidden">devices other</span>
        </button>
        <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
            <li class="mdl-menu__item">在其它设备中阅读本文章</li>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAADjklEQVR42u3aS27kMAwFwL7/pWe2A2RivEdKnUZQXgWx25bKC5qf1x/HP8cLAQ4cOHDgwIEDBw4cH8zxio+vv3r+z38eHN8zOfvdNfVecODAgQPHBY5kG8nZ50UnW3qGy1eSX4MDBw4cOO5xJIt4Dl1tAJ5d/7y2FhQHDhw4cHwOR/3gOHmbJXs4cODAgeN3cLThMy/bnf0gwIEDBw4c7+eYlf/yIl0eINvA/GO1Uhw4cODAsR5o+Py/3zrfgQMHDhw4vnC0x6bJlLSRTgXUYg04cODAgeMox6xstwlv+chC3u5alR1x4MCBA8dljqSBlIfGGfF+WCG5HgcOHDhw3OOYjaY9MyWh7pk7v8PmReLAgQMHjrMc7dLbVlCeqs2C+uwsDhw4cOC4x5EX/jbBNb9PsY1RcK0nB3HgwIEDR8kxS7faZlJbiMw3tm964cCBAweOsxyz4LQJ0vvxiKiZlO8CBw4cOHC8naMtBc5Stc3wxOZTAAcOHDhwvIdjNnawby/NsFasOHDgwIHjKEfd/o9Lh21KdnYA4tioHA4cOHDgKDn2A2fJ2XbpxTjCjVE5HDhw4MBxiKPd9vNy83DblhTzwLwKtDhw4MCB42jOsh9K25ca2wbYsHSIAwcOHDiOcuTDCu2Gz26yDdtFMokDBw4cOC5wDJOfcgPtEzfly2FxEAcOHDhwXGg7bQpwsxJhfre2NBkFeBw4cODAcZQj2eqsgZSkhfviYxvy6+8OHDhw4MBRcrTDZ22QS0Lshix5Yp3C4cCBAweOdXFwFlb3Qwz7EYf2dR7owuHAgQMHjqA4OEvk2mD83VY3YT7HwoEDBw4c7+HYQ7TlwtkY3P6D4GKtFAcOHDhwrEt+7VBCjt6Sbe6DAwcOHDhuc7SJ1my47fk++TWzFK7uwuHAgQMHjgscszRpNnDQbiZ5eQdqpThw4MCB4xDHZkDhbHlx33w6EGhx4MCBA0fA0R75ovPmUxsmZ2F1NdCAAwcOHDjKnGU1EBCE4Vlx8NTZ+rsDBw4cOHCsOfZjB/lwQ5FclXcbvhIcOHDgwHGNIx8LyJOxDdB+uCFqWeHAgQMHjg/gSAYF2hZUPgAxG4+rBxpw4MCBA8ePcuRtpzx1zLe3Km7iwIEDB45rHG1jadOmyn/7/J9NiMWBAwcOHPc42gSpHWs7WxyclSyLQIsDBw4cOBYcDhw4cODAgQMHDhw4cHzY8ReeWWdw9u+5agAAAABJRU5ErkJggg==">
        </ul>
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Android/">Android</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/ZXing/">ZXing</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Android 条码扫描&url=https://pengyuzhang.coding.me/PengyuZhang.coding.io//2017/03/14/Android/Android 条码扫描/index.html&via=BearZPY" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://pengyuzhang.coding.me/PengyuZhang.coding.io//2017/03/14/Android/Android 条码扫描/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=https://pengyuzhang.coding.me/PengyuZhang.coding.io//2017/03/14/Android/Android 条码扫描/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    
        <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=https://pengyuzhang.coding.me/PengyuZhang.coding.io//2017/03/14/Android/Android 条码扫描/index.html&title=Android 条码扫描" target="_blank">
            <li class="mdl-menu__item">
                分享到 LinkedIn
            </li>
        </a>
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=BearZPY Blog&title=Android 条码扫描&summary=null&pics=https://pengyuzhang.coding.me/PengyuZhang.coding.io/img/favicon.png&url=https://pengyuzhang.coding.me/PengyuZhang.coding.io/2017/03/14/Android/Android 条码扫描/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h1 id="Android-条码扫描"><a href="#Android-条码扫描" class="headerlink" title="Android 条码扫描"></a>Android 条码扫描</h1><p>Android 应用经常会遇到扫码的需求，目前使用的库主要是 ZXing 和 Zbar，本文主要讲述的是 ZXing 的使用。ZXing 官方例子是非常庞大的，考虑的方面也比较全，初学者理解上会有一定的困难，本文主要是帮助初学者理解 ZXing 库的使用。</p>
<h2 id="确定扫码功能的核心"><a href="#确定扫码功能的核心" class="headerlink" title="确定扫码功能的核心"></a>确定扫码功能的核心</h2><p>扫码功能可以很简单的分为拍摄和解码两大部分，拍摄功能很容易理解，就是拍摄一帧包含二维码的图像，而解码又分两部分，即对一帧图像里面条码的定位，以及对条码内容的解析。ZXing 已经帮我们完成了解码的两个部分，这是扫码功能的核心。而拍摄的功能可以由我们自行定制，我们需要做的只是提供一帧帧图像给 ZXing 的解码器。</p>
<h2 id="拍摄功能"><a href="#拍摄功能" class="headerlink" title="拍摄功能"></a>拍摄功能</h2><p>Android 实现拍摄设计到两个组件（Camera，和 View），其中最核心的是 Camera 的配置，View 主要负责显示拍摄的内容（在前置扫码需求下，View 甚至是可以不可见的），这部分都不涉及到 ZXing 的使用，这里只讲解最基本的的功能实现，取景框等放到最后理解。</p>
<h3 id="Camera-的基本参数配置"><a href="#Camera-的基本参数配置" class="headerlink" title="Camera 的基本参数配置"></a>Camera 的基本参数配置</h3><ul>
<li>选择使用的摄像头</li>
<li>设置拍摄图像的显示组件（SurfaceHolder）</li>
<li>选择对焦的模式</li>
<li>确定预览图像的大小（eg：1280*720）</li>
<li>设置摄像头的预览方向（成像方向）</li>
<li>设置单次预览图像的回调</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span>SurfaceHolder holder<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span> mCamera <span class="token operator">==</span> null <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mCamera <span class="token operator">=</span> Camera<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            mCamera<span class="token punctuation">.</span><span class="token function">setPreviewDisplay</span><span class="token punctuation">(</span> holder <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mCamera<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mCamera <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mCamera <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>LOG_TAG<span class="token punctuation">,</span><span class="token string">"surfaceChanged: mCamera == null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>callback <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                callback<span class="token punctuation">.</span><span class="token function">onCameraOpenFailed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mCameraParameters <span class="token operator">=</span> mCamera<span class="token punctuation">.</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCameraParameters<span class="token punctuation">.</span><span class="token function">setFocusMode</span><span class="token punctuation">(</span> Camera<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span>FOCUS_MODE_AUTO <span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCameraParameters<span class="token punctuation">.</span><span class="token function">setPreviewSize</span><span class="token punctuation">(</span> <span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">720</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        cameraResolution<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1280</span><span class="token punctuation">;</span>
        cameraResolution<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">720</span><span class="token punctuation">;</span>
        mCamera<span class="token punctuation">.</span><span class="token function">setParameters</span><span class="token punctuation">(</span> mCameraParameters <span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCamera<span class="token punctuation">.</span><span class="token function">setDisplayOrientation</span><span class="token punctuation">(</span> <span class="token number">90</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCamera<span class="token punctuation">.</span><span class="token function">startPreview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCamera<span class="token punctuation">.</span><span class="token function">cancelAutoFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCamera<span class="token punctuation">.</span><span class="token function">setAutoFocusMoveCallback</span><span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token class-name">AutoFocusMoveCallbackImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        previewCallbackImp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PreviewCallbackImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// Camera 返回一帧的预览图像，在此回调中，进行图像解码</span>
        mCamera<span class="token punctuation">.</span><span class="token function">setOneShotPreviewCallback</span><span class="token punctuation">(</span>previewCallbackImp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mCamera <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mCamera<span class="token punctuation">.</span><span class="token function">stopPreview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCamera<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCamera <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="View-的参数配置"><a href="#View-的参数配置" class="headerlink" title="View 的参数配置"></a>View 的参数配置</h3><p>显示拍摄内容需要使用控件 SurfaceView，这个控件需要通过 SurfaceHolder 来与摄像头连接起来。当需要拍摄时创建 SurfaceView，此时 SurfaceHolder 需要打开摄像头进行拍摄。当拍摄结束时销毁 SurfaceView，，此时 SurfaceHolder 关闭摄像头预览并释放资源。</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 创建 SurfaceView 后添加 SurfaceHolder 以显示拍摄内容</span>
surfaceView<span class="token punctuation">.</span><span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SurfaceHolderCallbackImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 随着 SurfaceView 的生命周期控制摄像头资源的使用和释放</span>
<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">SurfaceHolderCallbackImp</span> <span class="token keyword">implements</span> <span class="token class-name">SurfaceHolder<span class="token punctuation">.</span>Callback</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceCreated</span><span class="token punctuation">(</span>SurfaceHolder holder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceChanged</span><span class="token punctuation">(</span>SurfaceHolder holder<span class="token punctuation">,</span> <span class="token keyword">int</span> format<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        CameraManager<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>holder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceDestroyed</span><span class="token punctuation">(</span>SurfaceHolder holder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        CameraManager<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="解码功能"><a href="#解码功能" class="headerlink" title="解码功能"></a>解码功能</h2><p>解码功能就完全是 ZXing 库提供的了，我们需要按照我们自己的需求初始化 ZXing 的解码器，并将图像数据以正确的格式传给解码器。</p>
<h3 id="ZXing-解码器配置"><a href="#ZXing-解码器配置" class="headerlink" title="ZXing 解码器配置"></a>ZXing 解码器配置</h3><ul>
<li>配置解码的格式（只针对需要的格式解码可以提高速度）</li>
<li>设置特征点回调（特征点可以选择是否需要现在图像上）</li>
<li>配置字符集，配置解码精度等等（可选）</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 多格式解码器，如果只处理一种格式完全可以使用对应的解码器，以提高速度</span>
<span class="token keyword">private</span> MultiFormatReader qrcodeReader <span class="token operator">=</span> null<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initQRCodeReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Vector<span class="token operator">&lt;</span>BarcodeFormat<span class="token operator">></span> decodeFormats <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    decodeFormats<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>BarcodeFormat<span class="token punctuation">.</span>QR_CODE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    decodeFormats<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>BarcodeFormat<span class="token punctuation">.</span>DATA_MATRIX<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Hashtable<span class="token operator">&lt;</span>DecodeHintType<span class="token punctuation">,</span> Object<span class="token operator">></span> hints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hashtable</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    hints<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span> DecodeHintType<span class="token punctuation">.</span>POSSIBLE_FORMATS<span class="token punctuation">,</span> decodeFormats <span class="token punctuation">)</span><span class="token punctuation">;</span>
    hints<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span> DecodeHintType<span class="token punctuation">.</span>NEED_RESULT_POINT_CALLBACK<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ResultPointCallbackImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    qrcodeReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultiFormatReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    qrcodeReader<span class="token punctuation">.</span><span class="token function">setHints</span><span class="token punctuation">(</span> hints <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="拍摄图像处理"><a href="#拍摄图像处理" class="headerlink" title="拍摄图像处理"></a>拍摄图像处理</h3><p>拍摄完成的图像并不是可以直接送给解码器的，我们要对其进行提取亮度，二值化操作才行。在处理的过程中，我们可以对图像进行裁剪，配合裁剪可以实现取景框的功能。Android 相机预览默认格式是 yuv420sp，编码成 YUV 的所有像素格式里，yuv420sp 占用的空间是最小的。我们通过 PlanarYUVLuminanceSource 来提取亮度。提取亮度之后需要进行二值化操作，此处常见的二值化方法有两种，分别是 HybridBinarizer 和 GlobalHistogramBinarizer。其中 HybridBinarizer 继承自 GlobalHistogramBinarizer，识别精度要比 GlobalHistogramBinarizer 好，但是速度比其低。实际使用中应该根据具体需求去选择。</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlePreviewFrame</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token punctuation">,</span><span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 提取亮度，此处可选择是否做裁剪</span>
    PlanarYUVLuminanceSource source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PlanarYUVLuminanceSource</span><span class="token punctuation">(</span> data<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token boolean">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 配置二值化算法</span>
    BinaryBitmap bitmap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryBitmap</span><span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token class-name">HybridBinarizer</span><span class="token punctuation">(</span> source <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//BinaryBitmap bitmap = new BinaryBitmap( new GlobalHistogramBinarizer( source ) );</span>

    <span class="token comment" spellcheck="true">// 解码</span>
    Result result <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> qrcodeReader <span class="token operator">!=</span> null <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            result <span class="token operator">=</span> qrcodeReader<span class="token punctuation">.</span><span class="token function">decodeWithState</span><span class="token punctuation">(</span> bitmap <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//LogError( "NotFoundException: " + e );</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            qrcodeReader<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> result <span class="token operator">!=</span> null <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 扫描完成解码成功</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> scannerCallback <span class="token operator">!=</span> null <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            scannerCallback<span class="token punctuation">.</span><span class="token function">onScanSuccess</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="ZXing-官方例子补充"><a href="#ZXing-官方例子补充" class="headerlink" title="ZXing 官方例子补充"></a>ZXing 官方例子补充</h2><p>ZXing 的官方库中考虑了很多内容，所以在上述基本功能上添加了如下内容，只要先理解了核心功能，这些拓展功能的理解就相对容易多了。</p>
<pre><code>* 长时间无活动自动销毁机制，避免耗电 InactivityTimer
* 扫描完成蜂鸣器提醒机制 BeepManager
* 设置取景框，裁剪无用区域 ViewfinderView
* 首次使用确定最佳的聚焦模式并保存
* 首次使用计算最佳摄像头预览大小并保存
* 扫描发现的特征点显示在屏幕上
* 从相册中获取图片扫码（RGB格式）
</code></pre>
    

    
</div>


                

                <!-- Post Comments -->
                
                    




                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/03/23/Python/用 Python 批量处理图片/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/03/07/git/使用git clean清理工程文件/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/user.jpg" alt="BearZPY's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        965006619@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">3</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Android/">Android<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/categories/Gradle/">Gradle<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/Python/">Python<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/git/">git<span class="sidebar_archives-count">2</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="标签">
                
                    <i class="material-icons sidebar-material-icons">cloud</i>
                
                标签
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/BearZPY" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;BearZPY Blog
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->
<script src="/js/lazyload.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- Swiftye -->


<!-- Local Search-->


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
